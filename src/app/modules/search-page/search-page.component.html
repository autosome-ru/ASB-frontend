<div class="container flex-grow-1 mx-md-auto pb-3 px-sm-0 px-md-auto">

    <asb-search
        [width]="'full'"
        [isAdvanced]="isAdvancedSearch"
        [searchData]="searchSnpResults$ | async"
    ></asb-search>

    <hr class="v-divider" style="margin:0">
    <div style="background: #f8f8f8;" class="d-flex">
        <div class="container-fluid mx-auto" style="padding-bottom: 5px; padding-top: 5px">
            <div class="flex text-xs-right xs-12">
                <div class="text-xs-left">
                    <h4 class="headline text--bold-300 search-page__text">
                        {{getPhrase((searchSnpResults$ | async).length,
                        (searchSnpResultsLoading$ | async))}}

                        <mat-button-toggle-group
                            #group="matButtonToggleGroup"
                            [value]="initialGroupValue" (change)="_groupToggled($event)">
                            <mat-button-toggle
                                value="card"
                                matTooltip="card view"
                            >
                                <mat-icon svgIcon="list"></mat-icon>
                            </mat-button-toggle>

                            <mat-button-toggle
                                value="list"
                                matTooltip="table view"
                            >
                                <mat-icon svgIcon="list"></mat-icon>
                            </mat-button-toggle>
                        </mat-button-toggle-group>
                    </h4>
                </div>
            </div>
            <ng-container *ngIf="!(searchSnpResultsLoading$ | async); else loadingTemplate">
                <ng-container *ngIf="group.value === 'card'; else tableViewTemplate">
                    <div class="layout pb-2"
                         style="margin-bottom: 20px"
                         *ngFor="let snp of filteredSnpResults$ | async">
                        <mat-card
                            class="search-page__card"
                            asbElevation
                            role="group"
                            [routerLink]="'snps/' + snp.rsId + '/' + snp.altBase"
                        >
                            <mat-card-header class="layout border--radius-top-8 row wrap theme--dark">
                                <mat-card-title>
                                    <asb-snp-header
                                        [data]="snp"
                                        [snpCard]="false"
                                    >
                                    </asb-snp-header>
                                </mat-card-title>
                                <mat-card-subtitle>

                                </mat-card-subtitle>
                            </mat-card-header>
                            <mat-card-content>
                                <asb-snp-card
                                    [snpData]="snp"
                                    [noButtons]="true"
                                >
                                </asb-snp-card>
                            </mat-card-content>
                        </mat-card>
                    </div>
                </ng-container>

                <mat-paginator
                    *ngIf="(searchSnpResults$ | async).length > 0"
                    showFirstLastButtons
                    [pageSize]="pageSize"
                    [length]="(searchSnpResults$ | async).length"
                    [pageSizeOptions]="[3, 10, 25, 50, 100]"
                    (page)="_handlePageChange($event)"
                ></mat-paginator>

            </ng-container>
        </div>
    </div>
</div>

<ng-template #loadingTemplate>
    <div style="height: 370px">
        <div class="search-page__spinner">
            <mat-progress-spinner mode="indeterminate" color="accent" [diameter]="120"></mat-progress-spinner>
        </div>
    </div>
</ng-template>

<ng-template #manyValuesViewTemplate let-value="value">
    <div style="max-height: 140px; max-width: 120px; overflow: hidden; text-overflow: ellipsis;flex: 1; display:flex; flex-wrap: wrap">
    <span *ngFor="let object of value; let last=last; let i=index" style="overflow: hidden">
        <span *ngIf="i < 5" style="text-overflow: ellipsis">
            {{object?.name}}<span *ngIf="!last && i !== 4">;&nbsp;</span>
        </span>
        <span *ngIf="i==5">...</span>
    </span>
    </div>
</ng-template>

<ng-template #manyCellTypesViewTemplate let-value="value">
    <div
        style="max-height: 140px;
                max-width: 250px;
                overflow: hidden;
                text-overflow: ellipsis;
                flex: 1;
                flex-wrap: wrap;
                display: flex;"
    >
    <span
        *ngFor="let object of value; let last=last; let i=index"
          style="white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;"
    >
        <span *ngIf="i < 3">
            {{object?.name}}<span *ngIf="!last && i !== 4">;&nbsp;</span>
        </span>
    </span>
    </div>
</ng-template>

<ng-template #tableViewTemplate>
    <div class="layout">
        <asb-table
            #tableView
            [displayedColumns]="displayedColumns"
            [data]="filteredSnpResults$ | async"
            [columnModel]="columnModel"
            [clickableRow]="true"
            (rowClickEmitter)="_handleTableRowClick($event)"
        >
        </asb-table>
    </div>
</ng-template>


