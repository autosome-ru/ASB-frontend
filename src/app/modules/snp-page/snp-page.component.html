<ng-container *ngIf="!(snpDataLoading$ | async) && (snpData$ | async) as snpData">
    <div class="container snp-page px-0">

        <div class="border-bottom border-info" style="padding-left: 20px; padding-right: 20px">
            <asb-snp-header
                [data]="snpData"
            >
            </asb-snp-header>
        </div>

        <div style="margin-left: 20px; padding-top: 10px">
            <asb-snp-card
                [snpData]="snpData"
            >
            </asb-snp-card>
        </div>
        <mat-divider></mat-divider>
        <mat-accordion multi displayMode="flat" class="mat-elevation-z0">
            <mat-expansion-panel expanded="true" class="py-0 mat-elevation-z0">
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        <h4 class="col-auto pl-0 ml-0">Color scale</h4>
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <asb-color-scales
                    [refBase]="(snpData$ | async).refBase"
                    [altBase]="(snpData$ | async).altBase"
                >
                </asb-color-scales>
            </mat-expansion-panel>
            <mat-divider></mat-divider>
            <mat-expansion-panel expanded="true" class="py-0 mat-elevation-z0">

                <mat-expansion-panel-header>
                    <mat-panel-title>
                        <h4 class="col-auto pl-0 ml-0">Details</h4>
                    </mat-panel-title>
                </mat-expansion-panel-header>

                <mat-tab-group
                    animationDuration="0ms"
                    [selectedIndex]="(snpData$ | async)?.transFactors.length > 0 ? 0 : 1"
                >
                    <mat-tab>
                        <ng-container
                            [ngTemplateOutlet]="TfStatisticsTemplate"
                        >
                            <ng-template mat-tab-label>
                                <h6 class="col-auto d-none d-sm-block pl-0 ml-0"
                                >
                                    Transcription factors
                                </h6>
                                <span
                                    class="d-sm-none"
                                >
                                    Transcription factors
                                </span>
                            </ng-template>
                        </ng-container>
                    </mat-tab>
                    <mat-tab>
                        <ng-container
                            [ngTemplateOutlet]="ClStatisticsTemplate"
                        >
                            <ng-template mat-tab-label>
                                <h6 class="col-auto d-none d-sm-block pl-0 ml-0"
                                >
                                    Cell types
                                </h6>
                                <span
                                    class="d-sm-none"
                                >
                                    Cell types
                                </span>
                            </ng-template>
                        </ng-container>
                    </mat-tab>
                </mat-tab-group>
            </mat-expansion-panel>
            <mat-divider></mat-divider>
            <mat-expansion-panel expanded="true" class="py-0 mat-elevation-z0" #motifPanel>
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        <h4 class="col-auto pl-0 ml-0">Motif analysis</h4>
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <ng-container *ngIf="_getGoodTfs((snpData.transFactors)) && _getGoodTfs((snpData.transFactors)).length > 0; else noMotifAnalysisTemplate">
                    <asb-motifs
                        #asbMotifsComponent
                        [transcriptionFactors]="_getGoodTfs((snpData.transFactors))"
                    >

                    </asb-motifs>
                </ng-container>
            </mat-expansion-panel>
            <mat-divider></mat-divider>
            <mat-expansion-panel expanded="true" class="py-0 mat-elevation-z0">
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        <h4 class="col-auto pl-0 ml-0">Genetic associations</h4>
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <asb-phenotypes
                    [snpData]="snpData$ | async"
                >
                </asb-phenotypes>
            </mat-expansion-panel>
            <mat-divider></mat-divider>
            <mat-expansion-panel expanded="true" class="mat-elevation-z0">
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        <h4 class="col-auto pl-0 ml-0">Download</h4>
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <button
                    mat-raised-button
                    (click)="_downloadPage()"
                >
                    Download page in JSON
                </button>
            </mat-expansion-panel>
        </mat-accordion>
    </div>
</ng-container>


<ng-container *ngIf="(snpDataLoading$ | async)">
    <div class="snp-page__spinner">
        <mat-progress-spinner mode="indeterminate" color="accent"></mat-progress-spinner>
    </div>
</ng-container>

<ng-template #TfStatisticsTemplate>
    <asb-statistics
        *ngIf="snpData$ | async as snpData"
        #transcriptionFactors
        [objectData]="snpData?.transFactors || []"
        [tableColumnModel]="tfColumnModel"
        [initialDisplayedColumns]="tfDisplayedColumns"
        [action]="snpData?.transFactors.filter(filterCondition).length > 0 ? filterCondition : null"
        [snpName]="_createSnpName(snpData ,'tf')"
        [searchFunc]="searchFunction"
        (actionClicked)="openMotifAnalysis($event, _getGoodTfs(snpData.transFactors))"
        (downloadSnpInfo)="_downloadFile($event, 'tf')"
    >
        <ng-content></ng-content>
    </asb-statistics>
</ng-template>

<ng-template #ClStatisticsTemplate>
    <asb-statistics
        #cellLines
        [objectData]="(snpData$ | async)?.cellLines || []"
        [tableColumnModel]="clColumnModel"
        [initialDisplayedColumns]="clDisplayedColumns"
        [snpName]="_createSnpName((snpData$ | async),'cl')"
        [searchFunc]="searchFunction"
        (downloadSnpInfo)="_downloadFile($event, 'cl')"
    >
        <ng-content></ng-content>
    </asb-statistics>
</ng-template>

<ng-template #noMotifAnalysisTemplate>
    No concordant/discordant #FIXME
</ng-template>
